<div xmlns="http://www.w3.org/1999/html">

  <div *ngIf="searchResults; then showResults else searching"></div>

  <ng-template #showResults>
    <dl *ngIf="searchResults">
      <p *ngFor="let result of searchResults"
         (click)="openCode(result.type, result.code)"
         class="search-result" [class.active]="result.code===selectedCode">
        <dt>
          <span class="link" >{{result.code}}</span>
          <!--<a [routerLink]="['./', result.type, result.code]">{{result.code}}</a>-->
          <!-- ToDO better solution -->
          <span style="font-weight: normal" *ngIf="result.type === 'klv1s'"><br>{{result.parent.text}}</span>
        </dt>
        <!-- ngIf will be deleted when highlight is implemented for klv1 in the backend -->
        <ng-template *ngIf="result.type === 'klv1s'; else elseBlock"></ng-template>
        <ng-template #elseBlock>
          <ng-template [ngIf]="result.highlight.text != undefined">
            <dd [innerHtml]="result.highlight.text[0]"></dd>
          </ng-template>
          <ng-template *ngIf="result.highlight.text == undefined">
            <dd [innerHtml]="result.text"></dd>
            <div class='small top-buffer' *ngFor="let alternativeField of ['synonyms', 'inclusions', 'descriptions', 'relevant_codes', 'analogous_code_text']">
              <ng-template [ngIf]="result.highlight[alternativeField] != undefined">
                <dd>{{('LBL_' + alternativeField.toUpperCase()) | translate}}</dd>
                <ul>
                  <div *ngFor="let field of result.highlight[alternativeField]">
                    <li [innerHtml]="field"></li>
                  </div>
                </ul>
              </ng-template>
            </div>
          </ng-template>
        </ng-template>
      </p>
      <p *ngIf="searchResults.length==0">
        {{ 'LBL_NO_RESULTS' | translate }}
      </p>
    </dl>
  </ng-template>
  <ng-template #searching>
    <dl >
      <p >
        Searching...
        <!-- TODO add spinner ?-->
      </p>
    </dl>
  </ng-template>
</div>
